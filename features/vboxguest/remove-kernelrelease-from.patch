Remove KERNELRELEASE from Makefile.include.header

From: Rajiv M Ranganath <rajiv.ranganath@atihita.com>


---
 drivers/lambda/vboxguest/Makefile.include.header |   66 ----------------------
 drivers/lambda/vboxsf/Makefile.include.header    |   66 ----------------------
 2 files changed, 132 deletions(-)

diff --git a/drivers/lambda/vboxguest/Makefile.include.header b/drivers/lambda/vboxguest/Makefile.include.header
index bda987a..2d82afa 100644
--- a/drivers/lambda/vboxguest/Makefile.include.header
+++ b/drivers/lambda/vboxguest/Makefile.include.header
@@ -88,70 +88,6 @@ endif
 
 ifneq ($(MAKECMDGOALS),clean)
 
-ifeq ($(KERNELRELEASE),)
-
- #
- # building from this directory
- #
-
- # target kernel version
- ifndef KERN_VER
-  KERN_VER := $(shell uname -r)
- else
-  ifneq ($(shell if test -d /lib/modules/$(KERN_VER)/build; then echo yes; fi),yes)
-   KERN_VER := $(shell uname -r)
-  endif
- endif
-
- # kernel base directory
- ifndef KERN_DIR
-  KERN_DIR := /lib/modules/$(KERN_VER)/build
-  ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-   KERN_DIR := /usr/src/linux
-   ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-    $(error Error: unable to find the sources of your current Linux kernel. \
-	           Specify KERN_DIR=<directory> and run Make again)
-   endif
-   $(warning Warning: using /usr/src/linux as the source directory of your \
-                      Linux kernel. If this is not correct, specify \
-		      KERN_DIR=<directory> and run Make again.)
-  endif
- else
-  ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-   $(error Error: KERN_DIR does not point to a directory)
-  endif
- endif
-
- # includes
- ifndef KERN_INCL
-  KERN_INCL = $(KERN_DIR)/include
- endif
- ifneq ($(shell if test -d $(KERN_INCL); then echo yes; fi),yes)
-  $(error Error: unable to find the include directory for your current Linux \
-                 kernel. Specify KERN_INCL=<directory> and run Make again)
- endif
-
- # module install dir, only for current kernel
- ifneq ($(filter install install_rpm,$(MAKECMDGOALS)),)
-  ifndef MODULE_DIR
-   MODULE_DIR_TST := /lib/modules/$(KERN_VER)
-   ifeq ($(shell if test -d $(MODULE_DIR_TST); then echo yes; fi),yes)
-    MODULE_DIR := $(MODULE_DIR_TST)/misc
-   else
-    $(error Unable to find the folder to install the module to)
-   endif
-  endif # MODULE_DIR unspecified
- endif
-
- # guess kernel version (24 or 26)
- ifeq ($(shell if grep '"2\.4\.' $(KERN_INCL)/linux/version.h > /dev/null; then echo yes; fi),yes)
-  KERN_VERSION := 24
- else
-  KERN_VERSION := 26
- endif
-
-else # neq($(KERNELRELEASE),)
-
  #
  # building from kbuild (make -C <kernel_directory> M=`pwd`)
  #
@@ -163,8 +99,6 @@ else # neq($(KERNELRELEASE),)
   KERN_VERSION := 26
  endif
 
-endif # neq($(KERNELRELEASE),)
-
 # debug - show guesses.
 ifdef DEBUG
 $(warning dbg: KERN_DIR     = $(KERN_DIR))
diff --git a/drivers/lambda/vboxsf/Makefile.include.header b/drivers/lambda/vboxsf/Makefile.include.header
index bda987a..2d82afa 100644
--- a/drivers/lambda/vboxsf/Makefile.include.header
+++ b/drivers/lambda/vboxsf/Makefile.include.header
@@ -88,70 +88,6 @@ endif
 
 ifneq ($(MAKECMDGOALS),clean)
 
-ifeq ($(KERNELRELEASE),)
-
- #
- # building from this directory
- #
-
- # target kernel version
- ifndef KERN_VER
-  KERN_VER := $(shell uname -r)
- else
-  ifneq ($(shell if test -d /lib/modules/$(KERN_VER)/build; then echo yes; fi),yes)
-   KERN_VER := $(shell uname -r)
-  endif
- endif
-
- # kernel base directory
- ifndef KERN_DIR
-  KERN_DIR := /lib/modules/$(KERN_VER)/build
-  ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-   KERN_DIR := /usr/src/linux
-   ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-    $(error Error: unable to find the sources of your current Linux kernel. \
-	           Specify KERN_DIR=<directory> and run Make again)
-   endif
-   $(warning Warning: using /usr/src/linux as the source directory of your \
-                      Linux kernel. If this is not correct, specify \
-		      KERN_DIR=<directory> and run Make again.)
-  endif
- else
-  ifneq ($(shell if test -d $(KERN_DIR); then echo yes; fi),yes)
-   $(error Error: KERN_DIR does not point to a directory)
-  endif
- endif
-
- # includes
- ifndef KERN_INCL
-  KERN_INCL = $(KERN_DIR)/include
- endif
- ifneq ($(shell if test -d $(KERN_INCL); then echo yes; fi),yes)
-  $(error Error: unable to find the include directory for your current Linux \
-                 kernel. Specify KERN_INCL=<directory> and run Make again)
- endif
-
- # module install dir, only for current kernel
- ifneq ($(filter install install_rpm,$(MAKECMDGOALS)),)
-  ifndef MODULE_DIR
-   MODULE_DIR_TST := /lib/modules/$(KERN_VER)
-   ifeq ($(shell if test -d $(MODULE_DIR_TST); then echo yes; fi),yes)
-    MODULE_DIR := $(MODULE_DIR_TST)/misc
-   else
-    $(error Unable to find the folder to install the module to)
-   endif
-  endif # MODULE_DIR unspecified
- endif
-
- # guess kernel version (24 or 26)
- ifeq ($(shell if grep '"2\.4\.' $(KERN_INCL)/linux/version.h > /dev/null; then echo yes; fi),yes)
-  KERN_VERSION := 24
- else
-  KERN_VERSION := 26
- endif
-
-else # neq($(KERNELRELEASE),)
-
  #
  # building from kbuild (make -C <kernel_directory> M=`pwd`)
  #
@@ -163,8 +99,6 @@ else # neq($(KERNELRELEASE),)
   KERN_VERSION := 26
  endif
 
-endif # neq($(KERNELRELEASE),)
-
 # debug - show guesses.
 ifdef DEBUG
 $(warning dbg: KERN_DIR     = $(KERN_DIR))
